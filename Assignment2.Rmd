---
title: "Informative Title Name"
author: "69: Woojin Park and David Pham"
date: May 28, 2021
subtitle: STA304 - Assignment 2
output:
  pdf_document: default
---

```{r, include=FALSE}
knitr::opts_chunk$set(warning = FALSE, message = FALSE)
library(openintro)
library(tidyverse)
```



```{r, include = FALSE}

# Here you can load in the census data 

census_data <- read_csv("gss_clean.csv")

# Here you can load in the survey data

survey_data <- read_csv("ces2019-phone_clean.csv")

```


## Introduction

<Here you should have a few paragraphs of text introducing the problem, getting the reader interested/ready for the rest of the report.>

<Introduce terminology.>

<Highlight hypotheses.>

<Optional: You can also include a description of each section of this report as a last paragraph.>


## Data

<Type here a paragraph introducing the data, its context and as much info about the data collection process that you know.>
The data we will be using to create a regression model is from the 2019 Canadian Election Survey Phone data. The CES organization strives to learn more about Canadians' political opinions and behaviour and provide transparency about the thoughts of citizens (*). The information was initially created by calling eligible voting Canadians, and asking them about their thoughts on the political candidates and the state of the country.

The original .csv file for the CES data was quite messy and had many variables that were not used in this report. To clean the data, we first mutate the desired variables into distinguishable names that could be used in the model, such as age and gender. A few if/else clauses were used to make the data tidy. Next, we turn the appropriate variables into factor types so that the results can be properly interpreted. Finally, we select the variables that we thought were most appropriate for our model. A similar process was done for the GSS data.

```{r, include = FALSE}

#### You will need to update/clean the code below based off the variables you want to use in your post stratification.

survey_data <- 
  survey_data %>% 
  mutate(age = 2019-q2,
         # 1 is male, 0 is female
         gender = ifelse(q3==1, 1, 0),
         province = ifelse(q4 == 1, 'Newfoundland and Labrador',
                           ifelse(q4 == 2, 'Prince Edward Island',
                                  ifelse(q4 == 3, 'Nova Scotia',
                                         ifelse(q4 == 4, 'New Brunswick',
                                                ifelse(q4 == 5, 'Quebec',
                                                       ifelse(q4 == 6, 'Ontario',
                                                              ifelse(q4 == 7, 'Manitoba',
                                                                     ifelse(q4 == 8, 'Saskatchewan',
                                                                            ifelse(q4 == 9, 'Alberta',
                                                                                   ifelse(q4 == 10,
                                                                                          'British Columbia',
                                                                                          NA)))))))))),
         education = q61,
         # if the label is 21, -9, or -8, then they are not religious
         religion = ifelse(q62 == 21 | q62 ==  -9 | q62 == -8, 0, 1),
         income = ifelse(q69 < 0, 'Less than $25,000',
                         ifelse(q69 >= 0 & q69 < 25000, 'Less than $25,000',
                                ifelse(q69 >= 75000 & q69 <= 99999, '$75,000 to $99,999',
                                       ifelse(q69 >= 50000 & q69 < 75000, '$50,000 to $74,999',
                                              ifelse(q69 >= 25000 & q69 < 50000, '$25,000 to $49,999',
                                                     ifelse(q69 >= 125000, '$125,000 and more',
                                                            ifelse(q69 >= 100000 & q69 < 125000,
                                                                   '$100,000 to $ 124,999', 0))))))),
         vote_liberal = ifelse(q11==1, 1, 0)) %>% 
  select(age, gender, province, religion, education, income, vote_liberal)

survey_data$gender <- as.factor(survey_data$gender)
survey_data$province <- as.factor(survey_data$province)
survey_data$education <- as.factor(survey_data$education)
survey_data$religion <- as.factor(survey_data$religion)
survey_data$income <- factor(survey_data$income,
                             levels = c('Less than $25,000', '$25,000 to $49,999', '$50,000 to $74,999',
                                        '$75,000 to $99,999', '$100,000 to $ 124,999', '$125,000 and more'))

census_data <- census_data %>%
  mutate(age=round(age),
         gender = ifelse(sex=='Male', 1, 0),
         education = education,
         religion = ifelse(religion_has_affiliation == 'Has religious affiliation', 1, 0),
         income = income_respondent,
         province = province) %>%
  select(age, gender, education, religion, income, province)

census_data$gender <- as.factor(census_data$gender)
census_data$province <- as.factor(census_data$province)
census_data$education <- as.factor(census_data$education)
census_data$religion <- as.factor(census_data$religion)
census_data$income <- factor(census_data$income,
                             levels = c('Less than $25,000', '$25,000 to $49,999', '$50,000 to $74,999',
                                        '$75,000 to $99,999', '$100,000 to $ 124,999', '$125,000 and more'))

```

In summary, these are the most important variables collected from the survey:

- `age`: Age based on year of birth (discrete, numeric variable).
- `gender`: The gender of the respondent (nominal, categorical variable).
- `province`: Indicates which province/territory the respondent is currently living in. The labels are defined as so:
  + (1) Newfoundland and Labrador
  + (2) Prince Edward Island
  + (3) Nova Scotia
  + (4) New Brunswick
  + (5) Quebec
  + (6) Ontario
  + (7) Manitoba
  + (8) Saskatchewan
  + (9) Alberta
  + (10) British Columbia
  + (There were no respondents from the Northwest Territories, Yukon, or Nunavut.)
- `education`: Indicates the highest level of education the respondent has received. The labels are defined as such:
  + (-9): Don't know
  + (-8): Refused
  + (1): No schooling 
  + (2): Some elementary school
  + (3): Completed elementary school
  + (4): Some secondary/high school
  + (5): Completed secondary/high school
  + (6): Some technical, community college, CEGEP, College
  + (7): Completed technical, community college, CEGEP, College
  + (8): Some university
  + (9): Bachelor's degree
  + (10): Master's degree
  + (11): Professional degree or doctorate
- `religion`: The religion that the respondent follows. There are a plethora of religions out there in the world, so we will not be writing them all here. If you would like to see an exhaustive list of all the recorded responses, the CES has provided documentation for all survey data. For our report, we are interested in whether or not a respondent follows a religion. If they are religious, they will have a value of *1* in the data frame. Otherwise, the value for this variable is *0*. (cite)
- `income`: The income of a respondent before taxes. This variable has been turned into a factor variable and is organized into income brackets.
  
Here is the mean and standard deviation of all respondents' age:

```{r message = FALSE, include = TRUE, echo = FALSE}
# Use this to calculate some summary measures.
# hard coding values for table
options(digits = 3)

var = c('age')

mean_coeff = c(mean(survey_data$age))

sd_coeff = c(sd(survey_data$age))

# create the table
table = cbind(var, round(mean_coeff, digits = 3), round(sd_coeff, digits = 3))
colnames(table) = c('Variable Name', 'Mean', 'Standard Deviation')
knitr::kable(table, align = c("r","r"), caption="Means and standard deviations of all variables in the survey data.")

```

This is the only numeric variable, as it is nonsensical to find the mean and spread of categorical data; so that has been omitted.

```{r}
```


<Include a description of the numerical summaries. Remember you can use `r ` to use inline R code.>

```{r, echo = TRUE}

# Use this to create some plots. Should probably describe both the sample and population.

```

<Include a clear description of the plot(s). I would recommend one paragraph for each plot.> 

All analysis for this report was programmed using `R version 4.0.2`. 

## Methods

Next, we will focus on the model used to predict whether or not a respondent will vote for the Liberal party. We believe that logistic regression is the most appropriate for this model because the response we are interested in consists of binary outcomes.


### Model Specifics
We have used the Akaike Information Criterion (AIC) to help us remove unnecessary variables in our report. After running extensive summaries on the model, the predictors that the AIC kept were age, province, and income of the respondent. Our lowest value of the criterion was 4110. Hence, our final model looks like this:

$$ log(\frac{p}{1-p}) = \beta_0 + \beta_1  x_{age} + \beta_2  x_{province2} + \beta_3  x_{province3} +
\beta_4  x_{province4} + \beta_5  x_{province5} + \beta_6  x_{province6} + \beta_7  x_{province7} + 
\beta_8  x_{province8}$$

$$+ \beta_9  x_{province9} + \beta_{10}  x_{province10} + \beta_{11}  x_{income2} + \beta_{12}  x_{income3} + 
\beta_{13}  x_{income4} + \beta_{14}  x_{income5} + \beta_{15}  x_{income6} + \epsilon$$

where:

- $log(\frac{p}{1-p})$ is the logit function with probability $p$
- $\beta_0$ is the intercept term
- $\beta_1 x_{age}$ 


```{r, echo = TRUE, include=TRUE}

# Creating the Model
model <- glm(vote_liberal ~ age + province + income, data=survey_data, family = binomial)

# back1 = step(model, direction = "backward")

ggplot(survey_data, aes(x = age, y = vote_liberal, color = factor(province))) + geom_point()

# Model Results (to Report in Results section)
summary(model)
# OR
# broom::tidy(model)

### Don't show the results/output here...

```


## Post-Stratification 

<Here you should explain the poststratification process>

<In order to estimate the proportion of voters.....>

<To put math/LaTeX inline just use one set of dollar signs. Example: $\hat{y}^{PS}$ >

<To put math on its own line use two sets of dollar signs:>

$$ include.your.mathematical.model.here.if.you.have.some.math.to.show $$


All analysis for this report was programmed using `R version 4.0.2`. 



## Results 

```{r, include=FALSE}

# Creating the Model
model <- lm(vote_liberal ~ age, data=survey_data)

# Model Results (to Report in Results section)
# summary(model)
# OR
# broom::tidy(model)
```

```{r, include=FALSE}

library(knitr)
library(kableExtra)
library(gridExtra)

# Here I will perform the post-stratification calculation
census_data_counts <- census_data %>% 
  group_by(age, province, income) %>% 
  summarise(n=n())

census_data_counts

census_data_counts$estimate <-
  model %>%
  predict(newdata = census_data_counts)

group_by_age <- census_data_counts %>% 
  mutate(liberal_predict_prop = estimate*n) %>%
  group_by(age)%>%
  summarise(liberal_predict = sum(liberal_predict_prop)/sum(n))

group_by_province <- census_data_counts %>% 
  mutate(liberal_predict_prop = estimate*n) %>%
  group_by(province)%>%
  summarise(liberal_predict = sum(liberal_predict_prop)/sum(n))

group_by_income <- census_data_counts %>% 
  mutate(liberal_predict_prop = estimate*n) %>%
  group_by(income)%>%
  summarise(liberal_predict = sum(liberal_predict_prop)/sum(n))

group_by_age %>% kable(row.names=T, escape=F, caption="Logistic Regression Model Summary") %>% kable_styling(latex_options="HOLD_position")

group_by_province %>% kable(row.names=T, escape=F, caption="Logistic Regression Model Summary") %>% kable_styling(latex_options="HOLD_position")

group_by_income %>% kable(row.names=T, escape=F, caption="Logistic Regression Model Summary") %>% kable_styling(latex_options="HOLD_position")

```

<Here you present your results. You may want to put them into a well formatted table. Be sure that there is some text describing the results.>


<Note: Alternatively you can use the `knitr::kable` function to create a well formatted table from your code. See here: [https://rmarkdown.rstudio.com/lesson-7.html](https://rmarkdown.rstudio.com/lesson-7.html).>



<Remember you can use `r ` to use inline R code.>


```{r, include = FALSE}

# Here you can include some relevant visualizations.


```

<Include an explanation/interpretation of the visualizations. Make sure to comment on the appropriateness of the assumptions/results.>

## Conclusions

<Here you should give a summary of the Hypotheses, Methods and Results>

<Highlight Key Results.>

<Talk about big picture.>

<Comment on any Weaknesses.>

<Comment on Future Work/Next Steps>

<End with a concluding paragraph to wrap up the report.>


## Bibliography

1. Grolemund, G. (2014, July 16) *Introduction to R Markdown*. RStudio. [https://rmarkdown.rstudio.com/articles_intro.html](https://rmarkdown.rstudio.com/articles_intro.html). (Last Accessed: January 15, 2021) 

2. Dekking, F. M., et al. (2005) *A Modern Introduction to Probability and Statistics: Understanding why and how.* Springer Science & Business Media.

3.  Allaire, J.J., et. el. *References: Introduction to R Markdown*. RStudio. [https://rmarkdown.rstudio.com/docs/](https://rmarkdown.rstudio.com/docs/). (Last Accessed: January 15, 2021) 
